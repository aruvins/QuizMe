import styles from "@/styles/Home.module.css";
import { Button, Input } from "@mui/joy";
import Head from "next/head";
import { useState } from "react";
import useSWR from "swr";

const fetcher = (url, userText) =>{
  let data = fetch(url, {
    method: "POST",
    body: JSON.stringify({ text: userText }),
  }).then((r) => r.json());
  console.log("Sending to backend", userText);
  return data;

}
  

export default function Home() {

  const [questions, setQuestions] = useState();
  const [userText, setUserText] = useState();
  const [shouldFetch, setShouldFetch] = useState(false);

  const { data, error, isLoading } = useSWR(
    shouldFetch ? "/api/send-text" : null,
    (url) => fetcher(url, userText)
  );

  const handleTextAreaChange = (event) => {
    setUserText(event.target.value);
    console.log("Text area change logged");
  };

  const sendDocument = () => {
    setShouldFetch(true);
  };

  return (
    <>
      <Head>
        <title>QuizMe.com</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={styles.main}>
        <Input
          onChange={handleTextAreaChange}
          className={styles.textarea}
          placeholder="Type something..."
        />
        <Button onClick={sendDocument}>Submit</Button>
      </main>

      {data && <div>{JSON.stringify(data)}</div>}
    </>
  );
}
